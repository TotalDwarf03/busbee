{"version":3,"sources":["webpack:///webpack/bootstrap 7b9ffc627c594fca258f","webpack:///./src/app.js","webpack:///./src/heatcanvas.js"],"names":[],"mappings":";;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,KAAK;QACL;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;QAEA;QACA;;;;;;;;AC7DA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEqC;;;;;;;;ACtBrC;AAAA;AACA;AACA;AACA;AACe;AACf;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC,8DAA8D;AACnG;AACA;AACA,qCAAqC,+DAA+D;;AAEpG;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,iBAAiB,0BAA0B;AAC3C,6CAA6C;AAC7C;AACA;AACA;AACA;;AAEA,sHAAsH;AACtH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oBAAoB,aAAa;AACjC;AACA;AACA;;AAEA;AACA;AACA,0CAA0C,cAAc;AACxD;;AAEA,oDAAoD;AACpD,sDAAsD;AACtD,sDAAsD;AACtD,sDAAsD;AACtD;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,mBAAmB,wBAAwB;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,kCAAkC;AAClC,kCAAkC;AAClC;AACA,8CAA8C;AAC9C,8CAA8C;AAC9C;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA,oDAAoD,GAAG;AACvD;AACA;AACA;AACA;AACA;AACA;AACA","file":"heatcanvas.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7b9ffc627c594fca258f","/**\n * Copyright 2010-2011 Sun Ning <classicning@gmail.com>\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nexport {default} from \"./heatcanvas\";\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/app.js\n// module id = 0\n// module chunks = 0","/**\n * Heatmap api based on canvas\n *\n */\nexport default function HeatCanvas(canvas) {\n    if (typeof(canvas) == \"string\") {\n        this.canvas = document.getElementById(canvas);\n    } else {\n        this.canvas = canvas;\n    }\n    if (this.canvas == null) {\n        return null;\n    }\n\n    this._createWorker();\n\n    this.width = this.canvas.width;\n    this.height = this.canvas.height;\n\n    this.onRenderingStart = null;\n    this.onRenderingEnd = null;\n\n    this.data = {};\n    this.value = null;\n    this._valueWidth = null;\n    this._valueHeight = null;\n}\n\nHeatCanvas.prototype.resize = function(w, h) {\n    this.width = this.canvas.width = w;\n    this.height = this.canvas.height = h;\n\n    this.canvas.style.width = w + 'px';\n    this.canvas.style.height = h + 'px';\n};\n\nHeatCanvas.prototype.push = function(x, y, data) {\n    // ignore all data out of extent\n    if (x < 0 || x >= this.width) {\n        return ;\n    }\n    if (y < 0 || y >= this.height) {\n        return;\n    }\n\n    var id = x+y*this.width;\n    if (this.data[id]) {\n        this.data[id] = this.data[id] + data;\n    } else {\n        this.data[id] = data;\n    }\n};\n\nHeatCanvas.prototype.render = function(step, degree, f_value_color) {\n    step = step || 1;\n    degree = degree || HeatCanvas.LINEAR ;\n\n    if (this.width <= 0 || this.height <= 0)\n        return;\n\n    if (this._runCounter > 0) {\n        this.worker.terminate();\n        this._createWorker();\n    }\n    this._runCounter++;\n\n    var self = this;\n    this.worker.onmessage = function(e) {\n        self._runCounter--;\n        self.value = e.data.value;\n        self._valueWidth = e.data.width;\n        self._valueHeight = e.data.height;\n        self.data = {};                         // can spoil next rendering if onmessage happens between HeatCanvas.push and next render!\n        self._render(f_value_color);\n        if (self.onRenderingEnd) {\n            self.onRenderingEnd();\n        }\n    }\n    var msg = {\n        'data': this.data,\n        'width': this.width,\n        'height': this.height,\n        'step': step,\n        'degree': degree,\n        'value': this.value\n    };\n    this.worker.postMessage(msg);\n    if (this.onRenderingStart) {\n        this.onRenderingStart();\n    }\n};\n\n\nHeatCanvas.prototype._paletteSize = 512;\nHeatCanvas.prototype._defaultPalette = null;\n\nHeatCanvas.prototype._createWorker = function() {\n    this.worker = new Worker(HeatCanvas.getPath()+'heatcanvas-worker.js');\n    this._runCounter = 0;\n};\n\nHeatCanvas.prototype._render = function(f_value_color) {\n    var makeColor;\n    if (!f_value_color) {\n        this._ensureDefaultPalette();\n        f_value_color = HeatCanvas.defaultValue2Color;\n        var t = this;\n        makeColor = function(value) { return t._defaultPalette[Math.round(value * t._paletteSize)]; };\n    }\n    else\n        makeColor = function(value) { return HeatCanvas.hsla2rgba.apply(null, f_value_color(value)); };\n\n    if (this.width <= 0 || this.height <= 0) {\n        return;\n    }\n\n    var ctx = this.canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, this.width, this.height);\n\n    var defaultColor = this.bgcolor || [0, 0, 0, 255];\n    var canvasData = ctx.createImageData(this.width, this.height);\n    for (var i=0; i<canvasData.data.length; i+=4) {\n        canvasData.data[i] = defaultColor[0]; // r\n        canvasData.data[i+1] = defaultColor[1];\n        canvasData.data[i+2] = defaultColor[2];\n        canvasData.data[i+3] = defaultColor[3];\n    }\n\n    if (!(this.value instanceof Float32Array) || this.width != this._valueWidth || this.height != this._valueHeight) {  // canvas was resized while worker was computing heatmap\n        return;\n    }\n\n    var valLen = this.value.length;\n    if (valLen != this._valueWidth * this._valueHeight) {\n        console.error('HeatCanvas: inconsistent data w*h != len', this._valueWidth, this._valueHeight, '!=', valLen);\n        return;\n    }\n\n    // maximum\n    var maxValue = 0;\n    for (var id = 0; id < valLen; id++) {\n        if (this.value[id] > maxValue)\n            maxValue = this.value[id];\n    }\n\n    // MDC ImageData:\n    // data = [r1, g1, b1, a1, r2, g2, b2, a2 ...]\n    for (var pos = 0, pixelColorIndex = 0; pos < valLen; pos++, pixelColorIndex += 4) {\n        var color = makeColor(this.value[pos] / maxValue);\n\n        canvasData.data[pixelColorIndex] = color[0]; //r\n        canvasData.data[pixelColorIndex+1] = color[1]; //g\n        canvasData.data[pixelColorIndex+2] = color[2]; //b\n        canvasData.data[pixelColorIndex+3] = color[3]; //a\n    }\n    ctx.putImageData(canvasData, 0, 0);\n};\n\nHeatCanvas.prototype.clear = function() {\n    this.data = {};\n    this.value = null;\n\n    this.canvas.getContext(\"2d\").clearRect(0, 0, this.width, this.height);\n};\n\nHeatCanvas.prototype.exportImage = function() {\n    return this.canvas.toDataURL();\n};\n\nHeatCanvas.prototype._ensureDefaultPalette = function() {\n    if (this._defaultPalette && this._defaultPalette.length == this._paletteSize + 1)\n        return this;\n\n    var res = [];\n    for (var j = 0; j <= this._paletteSize; j++) {\n        var c = HeatCanvas.hsla2rgba.apply(null, HeatCanvas.defaultValue2Color(j / this._paletteSize));\n        res[j] = new Uint8ClampedArray(4);\n        res[j][0] = c[0];\n        res[j][1] = c[1];\n        res[j][2] = c[2];\n        res[j][3] = c[3];\n    }\n\n    this._defaultPalette = res;\n    return this;\n}\n\nconst defaultValue2ColorResult = new Float64Array(4);\ndefaultValue2ColorResult[1] = 0.8;// s\ndefaultValue2ColorResult[3] = 1.0;// a\nHeatCanvas.defaultValue2Color = function(value){\n    defaultValue2ColorResult[0] = (1 - value);// h\n    defaultValue2ColorResult[2] = value * 0.6;// l\n    return defaultValue2ColorResult;\n}\n\n// function copied from:\n// http://mjijackson.com/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript\nconst hsla2rgbaResult = new Uint8ClampedArray(4);\nHeatCanvas.hsla2rgba = function(h, s, l, a){\n    var r, g, b;\n\n    if(s == 0){\n        r = g = b = l;\n    }else{\n        function hue2rgb(p, q, t){\n            if(t < 0) t += 1;\n            if(t > 1) t -= 1;\n            if(t < 1/6) return p + (q - p) * 6 * t;\n            if(t < 1/2) return q;\n            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;\n            return p;\n        }\n\n        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        var p = 2 * l - q;\n        r = hue2rgb(p, q, h + 1/3);\n        g = hue2rgb(p, q, h);\n        b = hue2rgb(p, q, h - 1/3);\n    }\n\n    hsla2rgbaResult[0] = r * 255;\n    hsla2rgbaResult[1] = g * 255;\n    hsla2rgbaResult[2] = b * 255;\n    hsla2rgbaResult[3] = a * 255;\n    return hsla2rgbaResult;\n}\n\nHeatCanvas.LINEAR = 1;\nHeatCanvas.QUAD = 2;\nHeatCanvas.CUBIC = 3;\n\nHeatCanvas.getPath = function() {\n    var scriptTags = document.getElementsByTagName(\"script\");\n    for (var i=0; i<scriptTags.length; i++) {\n        var src = scriptTags[i].src;\n        var match = src.match(/heatcanvas(-[a-z0-9]{32})?\\.js/);\n        var pos = match ? match.index : 0;\n        if (pos > 0) {\n            return src.substring(0, pos);\n        }\n    }\n    return \"\";\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/heatcanvas.js\n// module id = 1\n// module chunks = 0"],"sourceRoot":""}